{% extends "base.html" %}

{% block content %}
    <form class="mt-3" method="POST">
        <div class="mb-3">
            <label for="titulo-tarefa" class="form-label">Título da tarefa</label>
            <input type="text" class="form-control" name="titulo-tarefa" id="titulo-tarefa"
                   value="{{ tarefa_selecionada.titulo_tarefa if tarefa_selecionada else ''}}" required>
        </div>

        <div class="mb-3">
            <label for="data-conclusao" class="form-label">Data de conclusão</label>
            <input type="date" class="form-control" name="data-conclusao" id="data-conclusao"
                   value="{{ tarefa_selecionada.data_conclusao if tarefa_selecionada else ''}}">
        </div>

        <button type="submit" class="btn btn-primary">Salvar</button>

        {% if tarefa_selecionada %}
            <a href="{{ url_for('agenda') }}" class="btn btn-secundary">Cancelar</a>
        {% endif %}
    </form>

    <h2 class="my-3">Lista de Tarefas</h2>

    {% if tarefas %}
        <ul>
    {% for tarefa in tarefas %}
        <li id="tarefa-{{ tarefa.id_tarefa }}" class="{{ 'concluida' if tarefa.concluida == 1 }}">
            <span>{{ tarefa.titulo_tarefa }} - {{ tarefa.data_conclusao }}</span>
            
            <div class="acoes">
                <button type="button" 
                        onclick="toggleTarefa('{{ tarefa.id_tarefa }}')" 
                        id="btn-{{ tarefa.id_tarefa }}" 
                        class="btn-status">
                    {{ 'Reabrir' if tarefa.concluida == 1 else 'Concluir' }}
                </button>

                <a href="{{ url_for('update', idTarefa=tarefa.id_tarefa) }}">Editar</a>
                <a href="{{ url_for('delete', idTarefa=tarefa.id_tarefa) }}">Apagar</a>
            </div>
        </li>
    {% endfor %}
</ul>

<script>
function toggleTarefa(id) {
    fetch(`/toggle/${id}`, { method: 'POST' })
    .then(() => window.location.reload());
}
</script>
    {% else %}
        <p>Nenhuma tarefa cadastrada</p>
    {% endif %}

    <script>
    function toggleTarefa(id) {
        fetch(`/toggle/${id}`, { method: 'POST' })
        .then(res => res.json())
        .then(data => {
            location.reload(); // Recarrega para aplicar os estilos CSS de concluída
        });
    }
    </script>
{% endblock %}